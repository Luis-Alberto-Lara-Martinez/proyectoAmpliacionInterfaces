<app-menu></app-menu>
<app-scroll-to-top></app-scroll-to-top>

<div class="container py-4" style="min-height: calc(100vh - 200px);">
  <h1 class="text-center fw-bold mb-4 fs-2">Historial de Pedidos</h1>

  <!-- Mensaje si no hay pedidos -->
  <div *ngIf="pedidos.length === 0" class="text-center p-5 bg-light rounded my-4">
    <p class="fs-5 text-secondary mb-0">No tienes pedidos realizados</p>
  </div>

  <!-- Lista de pedidos -->
  <div class="d-flex flex-column gap-3">
    <div *ngFor="let pedido of pedidos" class="card shadow-sm hover-card">
      <div class="card-header pedido-header text-white p-3">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
          <div>
            <h2 class="h4 mb-1 fw-bold">Pedido #{{ pedido.numFactura }}</h2>
            <span class="small opacity-90">{{ formatearFecha(pedido.fecha) }}</span>
          </div>
          <div>
            <span class="badge rounded-pill px-3 py-2 fw-bold" [ngClass]="obtenerClaseEstado(pedido.estado)">
              {{ pedido.estado | uppercase }}
            </span>
          </div>
        </div>
      </div>

      <div class="card-body p-3">
        <!-- Productos del pedido -->
        <div class="d-flex flex-column gap-2 mb-3 pb-3 border-bottom">
          <div *ngFor="let producto of pedido.productosConInfo" class="d-flex gap-3 align-items-center p-2 bg-light rounded producto-hover">
            <img [src]="producto.imagen" [alt]="producto.nombre" class="rounded border" style="width: 80px; height: 80px; object-fit: cover;">
            <div class="flex-grow-1">
              <p class="mb-1 fw-semibold fs-6">{{ producto.nombre }}</p>
              <p class="mb-0 small text-secondary">Cantidad: {{ producto.cantidad }} | Precio: {{ producto.precio }}€</p>
            </div>
          </div>
        </div>

        <!-- Resumen de precios -->
        <div class="d-flex flex-column gap-2 ms-auto" style="max-width: 300px;">
          <div class="d-flex justify-content-between small text-body-secondary">
            <span>Subtotal:</span>
            <span>{{ pedido.subprecio.toFixed(2) }}€</span>
          </div>
          <div class="d-flex justify-content-between small text-body-secondary">
            <span>IVA (21%):</span>
            <span>{{ pedido.iva.toFixed(2) }}€</span>
          </div>
          <div class="d-flex justify-content-between pt-2 border-top border-primary border-2 fs-5 fw-bold">
            <span>Total:</span>
            <span>{{ pedido.precioTotal.toFixed(2) }}€</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<app-pie-pagina></app-pie-pagina>

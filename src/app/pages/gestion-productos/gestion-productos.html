<app-menu></app-menu>
<app-scroll-to-top></app-scroll-to-top>

<main class="container py-4" role="main">
	<div class="d-flex justify-content-between align-items-center mb-3">
		<h1 class="h4 fw-semibold mb-0">Gestión de productos</h1>
		<span class="text-muted">{{ productos.length }} productos</span>
	</div>

	<!-- Formulario de nuevo producto -->
	<div class="card mb-4">
		<div class="card-header d-flex justify-content-between align-items-center">
			<h2 class="h6 mb-0">Añadir producto</h2>
			<button type="button" class="btn btn-primary btn-sm" (click)="agregarProducto()">Guardar</button>
		</div>
		<div class="card-body">
			<div class="row g-3">
				<div class="col-12 col-md-6">
					<label class="form-label">Nombre</label>
					<input type="text" class="form-control" [(ngModel)]="nuevoProducto.nombre" placeholder="Nombre del producto">
				</div>
				<div class="col-6 col-md-3">
					<label class="form-label">Marca</label>
					<input type="text" class="form-control" [(ngModel)]="nuevoProducto.marca" placeholder="Marca">
				</div>
				<div class="col-6 col-md-3">
					<label class="form-label">Categoría</label>
					<input type="text" class="form-control" [(ngModel)]="nuevoProducto.categoria" placeholder="Categoría">
				</div>
				<div class="col-6 col-md-3">
					<label class="form-label">Precio (€)</label>
					<input type="number" min="0" step="0.01" class="form-control" [(ngModel)]="nuevoProducto.precio">
				</div>
				<div class="col-6 col-md-3">
					<label class="form-label">Stock</label>
					<input type="number" min="0" class="form-control" [(ngModel)]="nuevoProducto.stock">
				</div>
				<div class="col-12">
					<label class="form-label">Imagen (URL)</label>
					  <input type="text" class="form-control" [(ngModel)]="listaImagenUrl" placeholder="https://...">
				</div>
				<div class="col-12">
					<label class="form-label">Descripción</label>
					<textarea class="form-control" rows="3" [(ngModel)]="nuevoProducto.descripcion" placeholder="Descripción breve"></textarea>
				</div>
			</div>
		</div>
	</div>

	<!-- Lista de productos -->
	<div class="d-flex flex-column gap-3">
		<div *ngFor="let p of productos" class="card shadow-sm">
			<div class="card-body d-flex flex-wrap align-items-start gap-3">
				<!-- Imagen -->
				<img [src]="(p.listaImagenes && p.listaImagenes[0]) || 'assets/placeholder.png'" alt="imagen" class="rounded border" style="width:80px;height:80px;object-fit:cover;">

				<!-- Info principal / edición -->
				<div class="flex-grow-1">
					<div class="d-flex justify-content-between align-items-center">
						<h2 class="h6 mb-0">{{ p.nombre }}</h2>
						<div class="d-flex gap-2">
							<button type="button" class="btn btn-outline-primary btn-sm" (click)="iniciarEdicion(p)" *ngIf="editandoId !== p.id">Editar</button>
							<button type="button" class="btn btn-primary btn-sm" (click)="guardarEdicion(p)" *ngIf="editandoId === p.id">Guardar</button>
							<button type="button" class="btn btn-secondary btn-sm" (click)="cancelarEdicion()" *ngIf="editandoId === p.id">Cancelar</button>
							<button type="button" class="btn btn-outline-danger btn-sm" (click)="eliminarProducto(p)">Eliminar</button>
						</div>
					</div>

					<!-- Vista -->
					<div *ngIf="editandoId !== p.id" class="text-body-secondary small mt-2">
						<span class="me-3">Marca: <strong>{{ p.marca }}</strong></span>
						<span class="me-3">Categoría: <strong>{{ p.categoria }}</strong></span>
						<span class="me-3">Precio: <strong>{{ p.precio }}€</strong></span>
						<span class="me-3">Stock: <strong>{{ p.stock }}</strong></span>
						<div class="mt-1">Descripción: {{ p.descripcion }}</div>
					</div>

					<!-- Edición -->
					<div *ngIf="editandoId === p.id" class="mt-2">
						<div class="row g-2">
							<div class="col-12 col-md-6">
								<label class="form-label">Nombre</label>
								<input type="text" class="form-control" [(ngModel)]="p.nombre">
							</div>
							<div class="col-6 col-md-3">
								<label class="form-label">Marca</label>
								<input type="text" class="form-control" [(ngModel)]="p.marca">
							</div>
							<div class="col-6 col-md-3">
								<label class="form-label">Categoría</label>
								<input type="text" class="form-control" [(ngModel)]="p.categoria">
							</div>
							<div class="col-6 col-md-3">
								<label class="form-label">Precio (€)</label>
								<input type="number" min="0" step="0.01" class="form-control" [(ngModel)]="p.precio">
							</div>
							<div class="col-6 col-md-3">
								<label class="form-label">Stock</label>
								<input type="number" min="0" class="form-control" [(ngModel)]="p.stock">
							</div>
							<div class="col-12">
								<label class="form-label">Imagen (URL)</label>
								<input type="text" class="form-control" [(ngModel)]="p.listaImagenes[0]">
							</div>
							<div class="col-12">
								<label class="form-label">Descripción</label>
								<textarea class="form-control" rows="3" [(ngModel)]="p.descripcion"></textarea>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</main>

<app-pie-pagina></app-pie-pagina>

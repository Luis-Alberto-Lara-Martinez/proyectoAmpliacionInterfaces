<app-menu></app-menu>
<app-scroll-to-top></app-scroll-to-top>

<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h4 fw-semibold mb-0">Carrito</h1>
    <span class="text-muted">{{ carrito.length }} productos</span>
  </div>

  <!-- Vacío -->
  <div *ngIf="carrito.length === 0" class="alert alert-info" role="alert">
    Tu carrito está vacío.
  </div>

  <!-- Lista de productos en cajitas horizontales -->
  <div class="d-flex flex-column gap-3">
    <div *ngFor="let producto of carrito" class="card shadow-sm">
      <div class="card-body d-flex flex-wrap align-items-start gap-3">
        <!-- Imagen -->
        <img [src]="producto.listaImagenes[0]" [alt]="producto.nombre" class="rounded border" style="width:80px;height:80px;object-fit:cover;">

        <!-- Info y controles -->
        <div class="flex-grow-1">
          <div class="d-flex justify-content-between align-items-center">
            <h2 class="h6 mb-0">{{ producto.nombre }}</h2>
            <div class="fw-semibold">{{ producto.precio }}€</div>
          </div>
          <p class="text-body-secondary small mb-2">{{ producto.descripcion }}</p>

          <div class="d-flex flex-wrap align-items-center gap-2">
            <label class="small text-body-secondary me-2">Cantidad</label>
            <input type="number" class="form-control form-control-sm" style="width:90px;" min="1" [value]="producto.cantidad || 1" (input)="actualizarCantidad(producto, $event)">

            <button type="button" class="btn btn-outline-danger btn-sm ms-auto" (click)="eliminarDelCarrito(producto.id)">Eliminar</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Resumen -->
  <div class="card mt-3">
    <div class="card-body d-flex flex-wrap justify-content-between align-items-center gap-3">
      <div class="d-flex flex-column">
        <div class="d-flex justify-content-between gap-4">
          <span class="text-body-secondary">Subtotal (sin IVA):</span>
          <span class="fw-semibold">{{ (precioTotal/1.21).toFixed(2) }}€</span>
        </div>
        <div class="d-flex justify-content-between gap-4">
          <span class="text-body-secondary">IVA (21%):</span>
          <span class="fw-semibold">{{ (precioTotal - (precioTotal/1.21)).toFixed(2) }}€</span>
        </div>
        <div class="d-flex justify-content-between gap-4 border-top pt-2 mt-2">
          <span class="fw-semibold">Total:</span>
          <span class="fw-bold">{{ precioTotal.toFixed(2) }}€</span>
        </div>
      </div>

      <div class="flex-grow-1 text-end">
        <app-paypal-button [totalCompra]="precioTotal"></app-paypal-button>
      </div>
    </div>
  </div>

</div>
<app-pie-pagina></app-pie-pagina>
